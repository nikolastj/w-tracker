<div class="container relative mx-auto h-full max-w-2xl md:p-6">
  <!-- Loader Overlay -->
  @if (isApiLoading()) {
    <div class="absolute inset-0 z-50 h-screen w-screen">
      <app-loader class="flex h-full w-full" [opacity]="80"></app-loader>
    </div>
  }

  <!-- Header -->
  <div class="mb-6 hidden md:block">
    <div class="mb-4 flex items-center gap-4">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="text-3xl font-bold">Add Running Workout</h1>
    </div>
    <p class="opacity-70">Track your running activities and progress</p>
  </div>

  <!-- Form -->
  <form [formGroup]="runningWorkoutForm" (ngSubmit)="saveWorkout()">
    <mat-card class="flex h-full flex-col p-3 md:p-6">
      <mat-card-content class="flex-1">
        <!-- Workout Type -->
        <div class="form-field">
          <label class="mb-4 block text-sm font-medium">Workout Type *</label>
          <ng-select
            [items]="workoutTypes"
            bindLabel="label"
            bindValue="value"
            formControlName="runWorkoutType"
            placeholder="Select workout type"
            [clearable]="false"
          >
          </ng-select>
          @if (
            runningWorkoutForm.controls.runWorkoutType.invalid &&
            runningWorkoutForm.controls.runWorkoutType.touched
          ) {
            <div class="mt-1 text-sm text-red-600">Workout type is required</div>
          }
        </div>

        <!-- Duration and Distance Row -->
        <div class="mt-2 flex gap-4">
          <!-- Duration -->
          <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Duration (minutes) *</mat-label>
            <input
              matInput
              type="number"
              formControlName="runDuration"
              placeholder="e.g., 30"
              min="1"
            />
            @if (runningWorkoutForm.controls.runDuration.hasError('required')) {
              <mat-error>Duration is required</mat-error>
            }
            @if (runningWorkoutForm.controls.runDuration.hasError('min')) {
              <mat-error>Duration must be at least 1 minute</mat-error>
            }
          </mat-form-field>

          <!-- Distance -->
          <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Distance (km)</mat-label>
            <input
              matInput
              type="number"
              formControlName="runDistance"
              placeholder="e.g., 5.2"
              step="0.1"
              min="0"
            />
            @if (runningWorkoutForm.controls.runDistance.hasError('min')) {
              <mat-error>Distance cannot be negative</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Date Created -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dateCreated" />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <!-- Comment -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Comments</mat-label>
          <textarea
            matInput
            formControlName="comment"
            rows="3"
            placeholder="How did you feel? Any notes..."
          ></textarea>
        </mat-form-field>
      </mat-card-content>

      <!-- Action Buttons -->
      <div class="mt-6 flex justify-between gap-4 pt-4">
        <button
          mat-stroked-button
          color="warn"
          type="button"
          (click)="discardWorkout()"
          class="px-6"
        >
          <mat-icon class="mr-2">delete_outline</mat-icon>
          Discard
        </button>

        <button
          mat-stroked-button
          color="accent"
          type="submit"
          [disabled]="isApiLoading() || runningWorkoutForm.invalid"
          class="px-6"
        >
          <mat-icon class="mr-2">save</mat-icon>
          Save Workout
        </button>
      </div>
    </mat-card>
  </form>
</div>
