<div class="container mx-auto max-w-4xl md:p-6">
  <!-- Header -->
  <div class="mb-8 hidden md:block">
    <div class="mb-4 flex items-center gap-4">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="text-3xl font-bold">Create New Workout</h1>
    </div>
    <p class="opacity-70">Design and create your custom workout routine</p>
  </div>

  <!-- Main Content Area -->
  <div class="grid gap-6">
    <!-- Workout Form -->
    @if (workoutForm) {
      <mat-card class="p-3 md:p-6">
        <h2 class="mb-4 text-xl font-semibold">Exercises</h2>

        <!-- Exercise List -->
        <div class="space-y-4">
          <!-- Add Exercise Section -->
          <div class="flex items-center gap-4">
            <!-- Add Exercise Button -->
            @if (!showExerciseSelect) {
              <button
                mat-raised-button
                color="primary"
                (click)="showAddExerciseDropdown()"
                class="px-6"
              >
                <mat-icon class="mr-2">add</mat-icon>
                Add New Exercise
              </button>
            }

            <!-- Exercise Type Selector -->
            @if (showExerciseSelect) {
              <div class="flex w-full max-w-md items-center gap-2">
                <ng-select
                  #exerciseTypeSelect
                  [items]="availableExerciseTypes"
                  bindLabel="name"
                  placeholder="Select an exercise type..."
                  (change)="onExerciseTypeSelected($event)"
                  [loading]="isLoading"
                  class="flex-1"
                >
                </ng-select>
                <button mat-icon-button (click)="cancelExerciseSelection()">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            }
          </div>

          <!-- Exercise expansion panels -->
          @if (workoutForm.exercisesArray.controls.length > 0) {
            <mat-accordion multi="false">
              @for (exercise of workoutForm.exercisesArray.controls; track $index) {
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      {{ exercise.controls.exerciseType.value?.name || 'New Exercise' }}
                      @if (hasExerciseVariation(exercise)) {
                        <span class="ml-2 opacity-70">
                          ({{ exercise.controls.exerciseType.value?.requisiteUsed }})
                        </span>
                      }
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <div class="p-4">
                    <app-exercise-instance-form [exerciseForm]="exercise" />

                    <div class="mt-6 flex justify-end">
                      <button
                        mat-stroked-button
                        color="warn"
                        (click)="removeExercise($index)"
                        class="px-4"
                      >
                        <mat-icon class="mr-1">delete</mat-icon>
                        Remove Exercise
                      </button>
                    </div>
                  </div>
                </mat-expansion-panel>
              }
            </mat-accordion>
          }
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex justify-between">
          <button mat-stroked-button color="warn" (click)="discardWorkout()" class="px-6">
            <mat-icon class="mr-2">delete_outline</mat-icon>
            Discard Workout
          </button>

          <button mat-stroked-button color="accent" [disabled]="!workoutForm.valid" class="px-6">
            <mat-icon class="mr-2">save</mat-icon>
            Save Workout
          </button>
        </div>
      </mat-card>
    }
  </div>
</div>
