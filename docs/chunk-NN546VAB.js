import{a as Dt,c as vt}from"./chunk-MRVFAIGK.js";import{a as wt}from"./chunk-ITKQOARO.js";import{a as Ct}from"./chunk-PXLQLCEV.js";import{a as pt,b as V,f as ht,g as gt,h as ft}from"./chunk-6TXZEPZD.js";import{b as kt}from"./chunk-EUKUEZWE.js";import"./chunk-YO6PYBD6.js";import"./chunk-MAKPJVCC.js";import{c as ut,d as mt}from"./chunk-Z65JGT6J.js";import{c as P,d as dt}from"./chunk-UM436QT6.js";import"./chunk-AT2W5Z2E.js";import"./chunk-GPI6QAEZ.js";import"./chunk-3U2X7UVV.js";import"./chunk-DW2C3LMS.js";import{a as it}from"./chunk-ZAS3L3ZL.js";import"./chunk-75SVKVAW.js";import{M as at,O as st,Q as N,R as lt,S as ct}from"./chunk-HQPJQNUQ.js";import{c as nt}from"./chunk-2ELLCBIN.js";import{Ab as d,Cb as m,Fc as C,Gb as U,Hb as L,Ib as Q,Ja as u,Jc as rt,Na as k,Qb as c,Sb as b,Ua as v,Wa as T,Yb as ot,_ as x,_a as Z,ca as j,da as K,ha as h,ia as g,ic as I,jb as F,jc as Y,kb as E,lc as S,mb as tt,mc as w,nb as et,ob as _,pb as i,qb as a,rb as H,s as G,sa as D,xa as X,y as J,yb as W,za as M}from"./chunk-GZYQEBDM.js";var O=class n{constructor(t){this.elementRef=t}scrollDelay=100;ngAfterViewInit(){setTimeout(()=>{this.scrollToBottom()},this.scrollDelay)}scrollToBottom(){let t=this.elementRef.nativeElement;t&&(t.scrollTop=t.scrollHeight)}static \u0275fac=function(e){return new(e||n)(k(M))};static \u0275dir=T({type:n,selectors:[["","appAutoScrollToBottom",""]],inputs:{scrollDelay:"scrollDelay"}})};var R=class n{constructor(t){this.elementRef=t}scrolledToTop=new Z;isInitialized=!1;initDelay=500;ngOnInit(){setTimeout(()=>{this.isInitialized=!0},this.initDelay)}onScroll(t){if(!this.isInitialized)return;let e=t.target;e&&e.scrollTop===0&&this.scrolledToTop.emit()}static \u0275fac=function(e){return new(e||n)(k(M))};static \u0275dir=T({type:n,selectors:[["","appScrollToTopDetector",""]],hostBindings:function(e,o){e&1&&d("scroll",function(s){return o.onScroll(s)})},outputs:{scrolledToTop:"scrolledToTop"}})};var St=class n extends Dt{constructor(e,o){super();this.http=e;this.notificationService=o}API_URL=dt.apiUrl;getMuscleData(){return this.getWithCache("muscles",{},()=>this.http.get(`${this.API_URL}/muscles`).pipe(mt({errorMessage:"Failed to load muscle data. Please try again.",notificationService:this.notificationService})))}static \u0275fac=function(o){return new(o||n)(j(rt),j(ut))};static \u0275prov=x({token:n,factory:n.\u0275fac,providedIn:"root"})};var yt=["timelineBody"];function xt(n,t){n&1&&H(0,"app-loader",2)}function Mt(n,t){if(n&1){let e=W();i(0,"div",6)(1,"div",7)(2,"span",8),c(3),a(),i(4,"span",9),c(5),a()(),i(6,"mat-calendar",10),d("selectedChange",function(r){h(e);let s=m();return g(s.onDateSelected(r))}),a()()}if(n&2){let e=t.$implicit,o=m();u(3),b(" ",o.getMonthName(e).month," "),u(2),b(" ",o.getMonthName(e).year," "),u(),_("startAt",e)("dateClass",o.dateClass)}}var q=class n extends gt{getFirstDayOfWeek(){return 1}static \u0275fac=(()=>{let t;return function(o){return(t||(t=X(n)))(o||n)}})();static \u0275prov=x({token:n,factory:n.\u0275fac})},A=class n{timelineBody;calendars;calendarMonths=[];loading=w(!1);dateFilter=w();workoutDates=w([]);runningWorkoutDates=w([]);stretchWorkoutDates=w([]);scrolledToTop=S();workoutDateClicked=S();previousMonthCount=0;constructor(){Y(()=>{let t=this.dateFilter();t?.fromDate&&t?.toDate&&this.handleCalendarUpdate()}),Y(()=>{this.workoutDatesSet(),this.runningWorkoutDatesSet(),this.stretchWorkoutDatesSet(),this.calendars?.forEach(t=>{t.updateTodaysDate()})})}getMonthName(t){let e=t.toLocaleDateString("en-US",{month:"long"}),o=t.toLocaleDateString("en-US",{year:"numeric"});return{month:e,year:o}}trackByMonth=(t,e)=>`${e.getFullYear()}-${e.getMonth()}-${this.workoutDates().length}-${this.runningWorkoutDates().length}-${this.stretchWorkoutDates().length}`;workoutDatesSet=I(()=>{let t=this.workoutDates();return new Set(t.map(e=>e.dateCreated.split("T")[0]))});runningWorkoutDatesSet=I(()=>{let t=this.runningWorkoutDates();return new Set(t.map(e=>e.dateCreated.split("T")[0]))});stretchWorkoutDatesSet=I(()=>{let t=this.stretchWorkoutDates();return new Set(t.map(e=>e.dateCreated.split("T")[0]))});dateClass=t=>{let e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${o}-${r}`,p=this.workoutDatesSet().has(s),f=this.runningWorkoutDatesSet().has(s),l=this.stretchWorkoutDatesSet().has(s);return p&&f&&l||p&&f?"workout-day workout-day-with-running":p&&l?"workout-day workout-day-with-stretch":f&&l?"running-workout-day running-workout-day-with-stretch":p?"workout-day":f?"running-workout-day":l?"stretch-workout-day":""};onDateSelected(t){if(!t)return;let e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),s=`${e}-${o}-${r}`,p=this.workoutDates().find(f=>f.dateCreated.split("T")[0]===s);p&&this.workoutDateClicked.emit(p)}onScrolledToTop(){!this.loading()&&this.calendarMonths.length>0&&this.scrolledToTop.emit()}handleCalendarUpdate(){this.calendarMonths.length>0&&this.previousMonthCount>0&&this.timelineBody?this.preserveScrollPositionDuringUpdate():this.generateCalendarMonths(),this.previousMonthCount=this.calendarMonths.length}preserveScrollPositionDuringUpdate(){if(!this.timelineBody)return;let t=this.timelineBody.nativeElement,e=t.scrollTop,o=t.scrollHeight;this.generateCalendarMonths(),setTimeout(()=>{let s=t.scrollHeight-o;t.scrollTop=e+s},0)}generateCalendarMonths(){let t=this.dateFilter();if(!t?.fromDate||!t?.toDate)return;let e=t.fromDate,o=t.toDate,r=[],s=new Date(e.getFullYear(),e.getMonth(),1);for(;s<=o;)r.push(new Date(s)),s.setMonth(s.getMonth()+1);let p=new Set(this.calendarMonths.map(l=>`${l.getFullYear()}-${l.getMonth()}`)),f=r.filter(l=>!p.has(`${l.getFullYear()}-${l.getMonth()}`));this.calendarMonths=[...this.calendarMonths,...f].sort((l,Wt)=>l.getTime()-Wt.getTime())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=v({type:n,selectors:[["app-timeline-calendar"]],viewQuery:function(e,o){if(e&1&&(U(yt,5),U(V,5)),e&2){let r;L(r=Q())&&(o.timelineBody=r.first),L(r=Q())&&(o.calendars=r)}},inputs:{loading:[1,"loading"],dateFilter:[1,"dateFilter"],workoutDates:[1,"workoutDates"],runningWorkoutDates:[1,"runningWorkoutDates"],stretchWorkoutDates:[1,"stretchWorkoutDates"]},outputs:{scrolledToTop:"scrolledToTop",workoutDateClicked:"workoutDateClicked"},features:[ot([{provide:pt,useClass:q}])],decls:8,vars:1,consts:[["timelineBody",""],[1,"relative","flex","h-full","flex-col","overflow-hidden"],[1,"absolute","inset-0","z-50"],[1,"timeline-header","flex-shrink-0"],[1,"w-full"],["appAutoScrollToBottom","","appScrollToTopDetector","",1,"timeline-body","appear","flex-1","overflow-y-auto",3,"scrolledToTop"],[1,"flex","flex-col"],[1,"dashboard-card","px-6","py-4","text-center"],[1,"dashboard-heading","mr-2","text-lg","font-semibold"],[1,"dashboard-text","text-base","opacity-70"],[1,"w-full",3,"selectedChange","startAt","dateClass"]],template:function(e,o){if(e&1){let r=W();i(0,"div",1),F(1,xt,1,0,"app-loader",2),i(2,"div",3),H(3,"mat-calendar",4),a(),i(4,"div",5,0),d("scrolledToTop",function(){return h(r),g(o.onScrolledToTop())}),tt(6,Mt,7,4,"div",6,o.trackByMonth,!0),a()()}e&2&&(u(),E(o.loading()?1:-1),u(5),et(o.calendarMonths))},dependencies:[C,ht,V,ft,P,O,R,kt],styles:["[_nghost-%COMP%]     .timeline-header mat-calendar table tbody{display:none}[_nghost-%COMP%]     .timeline-header mat-calendar th{padding-top:1rem;padding-bottom:8px}[_nghost-%COMP%]     .timeline-header mat-calendar tr:first-child th{width:100%;table-layout:fixed}[_nghost-%COMP%]     .timeline-header mat-calendar tr:first-child th{width:14.2857142857%}[_nghost-%COMP%]     .timeline-header mat-calendar tr:nth-child(2){display:none}[_nghost-%COMP%]     .timeline-body mat-calendar table thead{display:none}[_nghost-%COMP%]     mat-calendar mat-calendar-header{display:none}[_nghost-%COMP%]     mat-calendar td.mat-calendar-body-label{padding-top:0!important;padding-right:0!important;padding-bottom:0!important;visibility:hidden}[_nghost-%COMP%]     .mat-calendar-body-today{border:none!important;outline:none!important}[_nghost-%COMP%]     .mat-calendar-content{padding-bottom:0!important}[_nghost-%COMP%]     .workout-day{background:linear-gradient(135deg,var(--color-primary) 0%,var(--color-primary-gradient) 100%)!important;border-radius:50%!important;font-weight:600!important;opacity:.8!important}[_nghost-%COMP%]     .workout-day:hover{opacity:1!important}[_nghost-%COMP%]     .running-workout-day{background:linear-gradient(135deg,#10b981,#34d399)!important;border-radius:50%!important;font-weight:600!important;opacity:.8!important}[_nghost-%COMP%]     .running-workout-day:hover{opacity:1!important}[_nghost-%COMP%]     .stretch-workout-day{background:linear-gradient(135deg,#ec4899,#f472b6)!important;border-radius:50%!important;font-weight:600!important;opacity:.8!important}[_nghost-%COMP%]     .stretch-workout-day:hover{opacity:1!important}[_nghost-%COMP%]     .workout-day-with-running span.mat-calendar-body-cell-content{box-shadow:inset 0 0 0 7px #10b981!important}[_nghost-%COMP%]     .workout-day-with-stretch span.mat-calendar-body-cell-content{box-shadow:inset 0 0 0 7px #ec4899!important}[_nghost-%COMP%]     .running-workout-day-with-stretch span.mat-calendar-body-cell-content{box-shadow:inset 0 0 0 7px #ec4899!important}"]})};var B=class n{constructor(t,e,o){this.workoutsService=t;this.runningWorkoutsService=e;this.stretchWorkoutsService=o}workoutsData=[];runningWorkoutsData=[];stretchWorkoutsData=[];loading=D(!0);workoutSelected=S();dateFilter=D({fromDate:new Date(new Date().setMonth(new Date().getMonth()-4)),toDate:new Date(new Date().setHours(23,59,59,999))});workoutDates=D([]);runningWorkoutDates=D([]);stretchWorkoutDates=D([]);ngOnInit(){this.loadInitData()}onScrolledToTop(){if(this.loading())return;let t=this.dateFilter().fromDate;this.dateFilter.set({fromDate:new Date(t.getFullYear(),t.getMonth()-4,1),toDate:t}),this.loadWorkouts(this.dateFilter())}onWorkoutDateClicked(t){let e=this.workoutsData.find(o=>o.id===t.id);e&&this.workoutSelected.emit(e)}loadInitData(){this.loadWorkouts(this.dateFilter())}loadWorkouts(t){this.loading.set(!0),t.pageSize=120,J({workouts:this.workoutsService.getPaginatedWorkouts(t),runningWorkouts:this.runningWorkoutsService.getPaginatedRunningWorkouts(t),stretchWorkouts:this.stretchWorkoutsService.getPaginatedStretchWorkouts(t)}).subscribe({next:({workouts:e,runningWorkouts:o,stretchWorkouts:r})=>{let s=e.data||[],p=o.data||[],f=r.data||[];this.workoutsData=[...this.workoutsData,...s],this.runningWorkoutsData=[...this.runningWorkoutsData,...p],this.stretchWorkoutsData=[...this.stretchWorkoutsData,...f],this.workoutDates.set(this.workoutsData.map(l=>({id:l.id,dateCreated:l.dateCreated}))),this.runningWorkoutDates.set(this.runningWorkoutsData.map(l=>({id:l.id,dateCreated:l.dateCreated}))),this.stretchWorkoutDates.set(this.stretchWorkoutsData.map(l=>({id:l.id,dateCreated:l.dateCreated}))),this.loading.set(!1)},error:e=>{console.error("Failed to load workouts:",e),this.loading.set(!1)}})}static \u0275fac=function(e){return new(e||n)(k(vt),k(wt),k(Ct))};static \u0275cmp=v({type:n,selectors:[["app-workouts-timeline"]],outputs:{workoutSelected:"workoutSelected"},decls:2,vars:5,consts:[[1,"h-full","w-full"],[3,"scrolledToTop","workoutDateClicked","loading","dateFilter","workoutDates","runningWorkoutDates","stretchWorkoutDates"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"app-timeline-calendar",1),d("scrolledToTop",function(){return o.onScrolledToTop()})("workoutDateClicked",function(s){return o.onWorkoutDateClicked(s)}),a()()),e&2&&(u(),_("loading",o.loading())("dateFilter",o.dateFilter())("workoutDates",o.workoutDates())("runningWorkoutDates",o.runningWorkoutDates())("stretchWorkoutDates",o.stretchWorkoutDates()))},dependencies:[C,A],encapsulation:2})};function Tt(n,t){if(n&1){let e=W();i(0,"div",2)(1,"div",3)(2,"button",4),d("click",function(){h(e);let r=m();return g(r.clearSelection())}),i(3,"mat-icon",5),c(4,"close"),a()()(),i(5,"p",6),c(6),a(),i(7,"p",7),c(8),a()(),i(9,"button",8),d("click",function(){h(e);let r=m();return g(r.onViewWorkout())}),i(10,"mat-icon"),c(11,"visibility"),a(),c(12," View Workout "),a(),i(13,"button",9),d("click",function(){h(e);let r=m();return g(r.onEditWorkout())}),i(14,"mat-icon"),c(15,"edit"),a(),c(16," Edit Workout "),a()}if(n&2){let e=m();u(6),b(" ",e.formatWorkoutDate(e.selectedWorkout().dateCreated)," "),u(2),b("",e.selectedWorkout().exercises.length," exercises")}}function Ft(n,t){if(n&1){let e=W();i(0,"button",8),d("click",function(){h(e);let r=m();return g(r.onAddWorkout())}),i(1,"mat-icon"),c(2,"fitness_center"),a(),c(3," Add Workout "),a(),i(4,"button",8),d("click",function(){h(e);let r=m();return g(r.onAddRunningWorkout())}),i(5,"mat-icon"),c(6,"directions_run"),a(),c(7," Add Running Workout "),a(),i(8,"button",8),d("click",function(){h(e);let r=m();return g(r.onAddStretchWorkout())}),i(9,"mat-icon"),c(10,"accessibility_new"),a(),c(11," Add Stretch Workout "),a(),i(12,"button",9),d("click",function(){h(e);let r=m();return g(r.onViewStats())}),i(13,"mat-icon"),c(14,"bar_chart"),a(),c(15," View Stats "),a()}}var $=class n{constructor(t){this.router=t}selectedWorkout=w(null);clearWorkoutSelection=S();formatWorkoutDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}clearSelection(){this.clearWorkoutSelection.emit()}onAddWorkout(){this.router.navigate(["/workout/create"])}onAddRunningWorkout(){this.router.navigate(["/running-workout/create"])}onAddStretchWorkout(){this.router.navigate(["/stretch-workout/create"])}onViewStats(){console.log("View Stats clicked")}onEditWorkout(){let t=this.selectedWorkout();t&&(console.log("Edit Workout clicked for workout:",t),this.router.navigate(["/workout/edit",t.id]))}onViewWorkout(){let t=this.selectedWorkout();t&&console.log("View Workout clicked for workout:",t)}static \u0275fac=function(e){return new(e||n)(k(nt))};static \u0275cmp=v({type:n,selectors:[["app-feature-selection"]],inputs:{selectedWorkout:[1,"selectedWorkout"]},outputs:{clearWorkoutSelection:"clearWorkoutSelection"},decls:4,vars:1,consts:[[1,"flex","h-full","items-center","justify-center"],[1,"flex","w-full","max-w-md","flex-col","gap-4"],[1,"p-","flex","flex-col","items-center","gap-2","rounded-md","p-1","pb-4"],[1,"flex","h-0","w-full","overflow-visible"],["mat-icon-button","","color","primary","aria-label","Clear selection",1,"!rounded-lg","!bg-primary","opacity-50",3,"click"],[1,"text-textOnPrimary"],[1,"m-0","text-lg"],[1,"m-0"],["mat-raised-button","","color","primary",1,"flex","h-16","w-full","items-center","justify-center","gap-3","text-lg","font-medium",3,"click"],["mat-raised-button","","color","accent",1,"flex","h-16","w-full","items-center","justify-center","gap-3","text-lg","font-medium",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1),F(2,Tt,17,2)(3,Ft,16,0),a()()),e&2&&(u(2),E(o.selectedWorkout()?2:3))},dependencies:[C,N,st,at,ct,lt],encapsulation:2})};var _t=class n{authStateService=K(it);currentUser$;selectedWorkout=D(null);constructor(){this.currentUser$=this.authStateService.authState$.pipe(G(t=>t.user))}onWorkoutSelected(t){this.selectedWorkout.set(t)}onClearWorkoutSelection(){this.selectedWorkout.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=v({type:n,selectors:[["app-dashboard"]],decls:4,vars:1,consts:[[1,"flex","h-full","w-full","flex-col","overflow-hidden","lg:flex-row"],[1,"h-1/3","border-b-2","border-solid","border-gray-500","p-4","lg:order-2","lg:h-full","lg:w-2/3","lg:border-b-0","lg:border-l-2"],[3,"clearWorkoutSelection","selectedWorkout"],[1,"h-2/3","lg:order-1","lg:h-full","lg:w-1/3",3,"workoutSelected"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"app-feature-selection",2),d("clearWorkoutSelection",function(){return o.onClearWorkoutSelection()}),a()(),i(3,"app-workouts-timeline",3),d("workoutSelected",function(s){return o.onWorkoutSelected(s)}),a()()),e&2&&(u(2),_("selectedWorkout",o.selectedWorkout()))},dependencies:[C,N,P,B,$],encapsulation:2})};export{_t as DashboardComponent};
