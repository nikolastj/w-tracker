import{a as De,c as ve}from"./chunk-GA3NMUSR.js";import{a as pe,b as V,f as fe,g as ge,h as he,i as Ce}from"./chunk-AQUTJZAY.js";import{b as ke}from"./chunk-JUWJYSTN.js";import"./chunk-SD7DY4Q2.js";import{G as ue,H as me}from"./chunk-CPIKLXAK.js";import{c as N,d as de}from"./chunk-MEFIOVFB.js";import"./chunk-GB4RNXC2.js";import"./chunk-OPO5MMUY.js";import"./chunk-7HBLLMSP.js";import{a as re}from"./chunk-GUI74BY4.js";import"./chunk-Y3S3S6VT.js";import{M as ae,O as le,Q as I,R as se,S as ce}from"./chunk-LJLGRWVS.js";import{$b as k,Ca as Z,Jb as Q,Kb as Y,La as F,Ma as E,Mb as C,N as x,Nb as w,Oa as ee,Pa as te,Q as $,Qa as _,R as K,Ra as r,Sa as a,T as p,Ta as H,U as f,_a as b,aa as v,ab as s,cb as m,cc as ne,ea as X,ga as T,gb as U,hb as j,ib as L,ic as ie,n as G,oa as d,qb as c,r as J,sa as g,sb as y,wa as h,ya as W,yb as oe}from"./chunk-WDOU2XRE.js";var O=class n{constructor(e){this.elementRef=e}scrollDelay=100;ngAfterViewInit(){setTimeout(()=>{this.scrollToBottom()},this.scrollDelay)}scrollToBottom(){let e=this.elementRef.nativeElement;e&&(e.scrollTop=e.scrollHeight)}static \u0275fac=function(t){return new(t||n)(g(T))};static \u0275dir=W({type:n,selectors:[["","appAutoScrollToBottom",""]],inputs:{scrollDelay:"scrollDelay"}})};var P=class n{constructor(e){this.elementRef=e}scrolledToTop=new Z;isInitialized=!1;initDelay=500;ngOnInit(){setTimeout(()=>{this.isInitialized=!0},this.initDelay)}onScroll(e){if(!this.isInitialized)return;let t=e.target;t&&t.scrollTop===0&&this.scrolledToTop.emit()}static \u0275fac=function(t){return new(t||n)(g(T))};static \u0275dir=W({type:n,selectors:[["","appScrollToTopDetector",""]],hostBindings:function(t,o){t&1&&s("scroll",function(l){return o.onScroll(l)})},outputs:{scrolledToTop:"scrolledToTop"}})};var we=class n extends De{constructor(t,o){super();this.http=t;this.notificationService=o}API_URL=de.apiUrl;getMuscleData(){return this.getWithCache("muscles",{},()=>this.http.get(`${this.API_URL}/muscles`).pipe(me({errorMessage:"Failed to load muscle data. Please try again.",notificationService:this.notificationService})))}static \u0275fac=function(o){return new(o||n)($(ne),$(ue))};static \u0275prov=x({token:n,factory:n.\u0275fac,providedIn:"root"})};var ye=["timelineBody"];function Me(n,e){n&1&&H(0,"app-loader",2)}function xe(n,e){if(n&1){let t=b();r(0,"div",6)(1,"div",7)(2,"span",8),c(3),a(),r(4,"span",9),c(5),a()(),r(6,"mat-calendar",10),s("selectedChange",function(i){p(t);let l=m();return f(l.onDateSelected(i))}),a()()}if(n&2){let t=e.$implicit,o=m();d(3),y(" ",o.getMonthName(t).month," "),d(2),y(" ",o.getMonthName(t).year," "),d(),_("startAt",t)("dateClass",o.dateClass)}}var q=class n extends ge{getFirstDayOfWeek(){return 1}static \u0275fac=(()=>{let e;return function(o){return(e||(e=X(n)))(o||n)}})();static \u0275prov=x({token:n,factory:n.\u0275fac})},R=class n{timelineBody;calendars;calendarMonths=[];loading=w(!1);dateFilter=w();workoutDates=w([]);runningWorkoutDates=w([]);scrolledToTop=C();workoutDateClicked=C();previousMonthCount=0;constructor(){Y(()=>{let e=this.dateFilter();e?.fromDate&&e?.toDate&&this.handleCalendarUpdate()}),Y(()=>{this.workoutDatesSet(),this.runningWorkoutDatesSet(),this.calendars?.forEach(e=>{e.updateTodaysDate()})})}getMonthName(e){let t=e.toLocaleDateString("en-US",{month:"long"}),o=e.toLocaleDateString("en-US",{year:"numeric"});return{month:t,year:o}}trackByMonth=(e,t)=>`${t.getFullYear()}-${t.getMonth()}-${this.workoutDates().length}-${this.runningWorkoutDates().length}`;workoutDatesSet=Q(()=>{let e=this.workoutDates();return new Set(e.map(t=>t.dateCreated.split("T")[0]))});runningWorkoutDatesSet=Q(()=>{let e=this.runningWorkoutDates();return new Set(e.map(t=>t.dateCreated.split("T")[0]))});dateClass=e=>{let t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),l=`${t}-${o}-${i}`,u=this.workoutDatesSet().has(l),S=this.runningWorkoutDatesSet().has(l);return u&&S?"workout-day workout-day-with-running":S?"running-workout-day":u?"workout-day":""};onDateSelected(e){if(!e)return;let t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),l=`${t}-${o}-${i}`,u=this.workoutDates().find(S=>S.dateCreated.split("T")[0]===l);u&&this.workoutDateClicked.emit(u)}onScrolledToTop(){!this.loading()&&this.calendarMonths.length>0&&this.scrolledToTop.emit()}handleCalendarUpdate(){this.calendarMonths.length>0&&this.previousMonthCount>0&&this.timelineBody?this.preserveScrollPositionDuringUpdate():this.generateCalendarMonths(),this.previousMonthCount=this.calendarMonths.length}preserveScrollPositionDuringUpdate(){if(!this.timelineBody)return;let e=this.timelineBody.nativeElement,t=e.scrollTop,o=e.scrollHeight;this.generateCalendarMonths(),setTimeout(()=>{let l=e.scrollHeight-o;e.scrollTop=t+l},0)}generateCalendarMonths(){let e=this.dateFilter();if(!e?.fromDate||!e?.toDate)return;let t=e.fromDate,o=e.toDate,i=[],l=new Date(t.getFullYear(),t.getMonth(),1);for(;l<=o;)i.push(new Date(l)),l.setMonth(l.getMonth()+1);let u=new Set(this.calendarMonths.map(D=>`${D.getFullYear()}-${D.getMonth()}`)),S=i.filter(D=>!u.has(`${D.getFullYear()}-${D.getMonth()}`));this.calendarMonths=[...this.calendarMonths,...S].sort((D,_e)=>D.getTime()-_e.getTime())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=h({type:n,selectors:[["app-timeline-calendar"]],viewQuery:function(t,o){if(t&1&&(U(ye,5),U(V,5)),t&2){let i;j(i=L())&&(o.timelineBody=i.first),j(i=L())&&(o.calendars=i)}},inputs:{loading:[1,"loading"],dateFilter:[1,"dateFilter"],workoutDates:[1,"workoutDates"],runningWorkoutDates:[1,"runningWorkoutDates"]},outputs:{scrolledToTop:"scrolledToTop",workoutDateClicked:"workoutDateClicked"},features:[oe([{provide:pe,useClass:q}])],decls:8,vars:1,consts:[["timelineBody",""],[1,"relative","flex","h-full","flex-col","overflow-hidden"],[1,"absolute","inset-0","z-50"],[1,"timeline-header","flex-shrink-0"],[1,"w-full"],["appAutoScrollToBottom","","appScrollToTopDetector","",1,"timeline-body","appear","flex-1","overflow-y-auto",3,"scrolledToTop"],[1,"flex","flex-col"],[1,"dashboard-card","px-6","py-4","text-center"],[1,"dashboard-heading","mr-2","text-lg","font-semibold"],[1,"dashboard-text","text-base","opacity-70"],[1,"w-full",3,"selectedChange","startAt","dateClass"]],template:function(t,o){if(t&1){let i=b();r(0,"div",1),F(1,Me,1,0,"app-loader",2),r(2,"div",3),H(3,"mat-calendar",4),a(),r(4,"div",5,0),s("scrolledToTop",function(){return p(i),f(o.onScrolledToTop())}),ee(6,xe,7,4,"div",6,o.trackByMonth,!0),a()()}t&2&&(d(),E(o.loading()?1:-1),d(5),te(o.calendarMonths))},dependencies:[k,fe,V,he,N,O,P,ke],styles:["[_nghost-%COMP%]     .timeline-header mat-calendar table tbody{display:none}[_nghost-%COMP%]     .timeline-header mat-calendar th{padding-top:1rem;padding-bottom:8px}[_nghost-%COMP%]     .timeline-header mat-calendar tr:first-child th{width:100%;table-layout:fixed}[_nghost-%COMP%]     .timeline-header mat-calendar tr:first-child th{width:14.2857142857%}[_nghost-%COMP%]     .timeline-header mat-calendar tr:nth-child(2){display:none}[_nghost-%COMP%]     .timeline-body mat-calendar table thead{display:none}[_nghost-%COMP%]     mat-calendar mat-calendar-header{display:none}[_nghost-%COMP%]     mat-calendar td.mat-calendar-body-label{padding-top:0!important;padding-right:0!important;padding-bottom:0!important;visibility:hidden}[_nghost-%COMP%]     .mat-calendar-body-today{border:none!important;outline:none!important}[_nghost-%COMP%]     .mat-calendar-content{padding-bottom:0!important}[_nghost-%COMP%]     .workout-day{background:linear-gradient(135deg,var(--color-primary) 0%,var(--color-primary-gradient) 100%)!important;border-radius:50%!important;font-weight:600!important;opacity:.8!important}[_nghost-%COMP%]     .workout-day:hover{opacity:1!important}[_nghost-%COMP%]     .running-workout-day{background:linear-gradient(135deg,#10b981,#34d399)!important;border-radius:50%!important;font-weight:600!important;opacity:.8!important}[_nghost-%COMP%]     .running-workout-day:hover{opacity:1!important}[_nghost-%COMP%]     .workout-day-with-running span.mat-calendar-body-cell-content{box-shadow:inset 0 0 0 7px #10b981!important}"]})};var B=class n{constructor(e,t){this.workoutsService=e;this.runningWorkoutsService=t}workoutsData=[];runningWorkoutsData=[];loading=v(!0);workoutSelected=C();dateFilter=v({fromDate:new Date(new Date().setMonth(new Date().getMonth()-4)),toDate:new Date(new Date().setHours(23,59,59,999))});workoutDates=v([]);runningWorkoutDates=v([]);ngOnInit(){this.loadInitData()}onScrolledToTop(){if(this.loading())return;let e=this.dateFilter().fromDate;this.dateFilter.set({fromDate:new Date(e.getFullYear(),e.getMonth()-4,1),toDate:e}),this.loadWorkouts(this.dateFilter())}onWorkoutDateClicked(e){let t=this.workoutsData.find(o=>o.id===e.id);t&&this.workoutSelected.emit(t)}loadInitData(){this.loadWorkouts(this.dateFilter())}loadWorkouts(e){this.loading.set(!0),e.pageSize=120,J({workouts:this.workoutsService.getPaginatedWorkouts(e),runningWorkouts:this.runningWorkoutsService.getPaginatedRunningWorkouts(e)}).subscribe({next:({workouts:t,runningWorkouts:o})=>{let i=t.data||[],l=o.data||[];this.workoutsData=[...this.workoutsData,...i],this.runningWorkoutsData=[...this.runningWorkoutsData,...l],this.workoutDates.set(this.workoutsData.map(u=>({id:u.id,dateCreated:u.dateCreated}))),this.runningWorkoutDates.set(this.runningWorkoutsData.map(u=>({id:u.id,dateCreated:u.dateCreated}))),this.loading.set(!1)},error:t=>{console.error("Failed to load workouts:",t),this.loading.set(!1)}})}static \u0275fac=function(t){return new(t||n)(g(ve),g(Ce))};static \u0275cmp=h({type:n,selectors:[["app-workouts-timeline"]],outputs:{workoutSelected:"workoutSelected"},decls:2,vars:4,consts:[[1,"h-full","w-full"],[3,"scrolledToTop","workoutDateClicked","loading","dateFilter","workoutDates","runningWorkoutDates"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"app-timeline-calendar",1),s("scrolledToTop",function(){return o.onScrolledToTop()})("workoutDateClicked",function(l){return o.onWorkoutDateClicked(l)}),a()()),t&2&&(d(),_("loading",o.loading())("dateFilter",o.dateFilter())("workoutDates",o.workoutDates())("runningWorkoutDates",o.runningWorkoutDates()))},dependencies:[k,R],encapsulation:2})};function Te(n,e){if(n&1){let t=b();r(0,"div",2)(1,"div",3)(2,"button",4),s("click",function(){p(t);let i=m();return f(i.clearSelection())}),r(3,"mat-icon",5),c(4,"close"),a()()(),r(5,"p",6),c(6),a(),r(7,"p",7),c(8),a()(),r(9,"button",8),s("click",function(){p(t);let i=m();return f(i.onViewWorkout())}),r(10,"mat-icon"),c(11,"visibility"),a(),c(12," View Workout "),a(),r(13,"button",9),s("click",function(){p(t);let i=m();return f(i.onEditWorkout())}),r(14,"mat-icon"),c(15,"edit"),a(),c(16," Edit Workout "),a()}if(n&2){let t=m();d(6),y(" ",t.formatWorkoutDate(t.selectedWorkout().dateCreated)," "),d(2),y("",t.selectedWorkout().exercises.length," exercises")}}function We(n,e){if(n&1){let t=b();r(0,"button",8),s("click",function(){p(t);let i=m();return f(i.onAddWorkout())}),r(1,"mat-icon"),c(2,"fitness_center"),a(),c(3," Add Workout "),a(),r(4,"button",8),s("click",function(){p(t);let i=m();return f(i.onAddRunningWorkout())}),r(5,"mat-icon"),c(6,"directions_run"),a(),c(7," Add Running Workout "),a(),r(8,"button",9),s("click",function(){p(t);let i=m();return f(i.onViewStats())}),r(9,"mat-icon"),c(10,"bar_chart"),a(),c(11," View Stats "),a()}}var A=class n{constructor(e){this.router=e}selectedWorkout=w(null);clearWorkoutSelection=C();formatWorkoutDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}clearSelection(){this.clearWorkoutSelection.emit()}onAddWorkout(){this.router.navigate(["/workout/create"])}onAddRunningWorkout(){this.router.navigate(["/running-workout/create"])}onViewStats(){console.log("View Stats clicked")}onEditWorkout(){let e=this.selectedWorkout();e&&(console.log("Edit Workout clicked for workout:",e),this.router.navigate(["/workout/edit",e.id]))}onViewWorkout(){let e=this.selectedWorkout();e&&console.log("View Workout clicked for workout:",e)}static \u0275fac=function(t){return new(t||n)(g(ie))};static \u0275cmp=h({type:n,selectors:[["app-feature-selection"]],inputs:{selectedWorkout:[1,"selectedWorkout"]},outputs:{clearWorkoutSelection:"clearWorkoutSelection"},decls:4,vars:1,consts:[[1,"flex","h-full","items-center","justify-center"],[1,"flex","w-full","max-w-md","flex-col","gap-4"],[1,"p-","flex","flex-col","items-center","gap-2","rounded-md","p-1","pb-4"],[1,"flex","h-0","w-full","overflow-visible"],["mat-icon-button","","color","primary","aria-label","Clear selection",1,"!rounded-lg","!bg-primary","opacity-50",3,"click"],[1,"text-textOnPrimary"],[1,"m-0","text-lg"],[1,"m-0"],["mat-raised-button","","color","primary",1,"flex","h-16","w-full","items-center","justify-center","gap-3","text-lg","font-medium",3,"click"],["mat-raised-button","","color","accent",1,"flex","h-16","w-full","items-center","justify-center","gap-3","text-lg","font-medium",3,"click"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"div",1),F(2,Te,17,2)(3,We,12,0),a()()),t&2&&(d(2),E(o.selectedWorkout()?2:3))},dependencies:[k,I,le,ae,ce,se],encapsulation:2})};var Se=class n{authStateService=K(re);currentUser$;selectedWorkout=v(null);constructor(){this.currentUser$=this.authStateService.authState$.pipe(G(e=>e.user))}onWorkoutSelected(e){this.selectedWorkout.set(e)}onClearWorkoutSelection(){this.selectedWorkout.set(null)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=h({type:n,selectors:[["app-dashboard"]],decls:4,vars:1,consts:[[1,"flex","h-full","w-full","flex-col","overflow-hidden","lg:flex-row"],[1,"h-1/3","border-b-2","border-solid","border-gray-500","p-4","lg:order-2","lg:h-full","lg:w-2/3","lg:border-b-0","lg:border-l-2"],[3,"clearWorkoutSelection","selectedWorkout"],[1,"h-2/3","lg:order-1","lg:h-full","lg:w-1/3",3,"workoutSelected"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"div",1)(2,"app-feature-selection",2),s("clearWorkoutSelection",function(){return o.onClearWorkoutSelection()}),a()(),r(3,"app-workouts-timeline",3),s("workoutSelected",function(l){return o.onWorkoutSelected(l)}),a()()),t&2&&(d(2),_("selectedWorkout",o.selectedWorkout()))},dependencies:[k,I,N,B,A],encapsulation:2})};export{Se as DashboardComponent};
