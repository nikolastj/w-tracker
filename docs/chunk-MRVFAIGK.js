import{c as f,d as s}from"./chunk-Z65JGT6J.js";import{d}from"./chunk-UM436QT6.js";import{J as y,Jc as l,X as n,_ as h,ca as c,n as u,s as v}from"./chunk-GZYQEBDM.js";var g=class{cache=new Map;createCacheKey(e,t){let o=JSON.stringify(t,Object.keys(t).sort());return`${e}:${o}`}getCachedResponse(e,t){let o=this.createCacheKey(e,t);return this.cache.get(o)}fetchAndCache(e,t,o){let r=this.createCacheKey(e,t);return o().pipe(n(a=>this.cache.set(r,a)))}getWithCache(e,t,o){let r=this.getCachedResponse(e,t);return r?u(r).pipe(y(100)):this.fetchAndCache(e,t,o)}clearCache(e,t){if(e&&t!==void 0){let o=this.createCacheKey(e,t);this.cache.delete(o)}else e?Array.from(this.cache.keys()).filter(r=>r.startsWith(`${e}:`)).forEach(r=>this.cache.delete(r)):this.cache.clear()}};var W=class i extends g{constructor(t,o){super();this.http=t;this.notificationService=o}API_URL=d.apiUrl;getExerciseTypes(){return this.getWithCache("exercise-types",{},()=>this.http.get(`${this.API_URL}/exercise-types`).pipe(s({errorMessage:"Failed to load exercise types. Please try again.",notificationService:this.notificationService})))}static \u0275fac=function(o){return new(o||i)(c(l),c(f))};static \u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})};var b=class i{constructor(e,t){this.http=e;this.notificationService=t}API_URL=d.apiUrl;paginatedWorkoutsCache=new Map;getPaginatedWorkouts(e){return this.http.post(`${this.API_URL}/workouts/paginated`,e).pipe(n(t=>{let o=JSON.stringify(e);this.paginatedWorkoutsCache.set(o,t)}),s({errorMessage:"Failed to load workouts. Please try again.",notificationService:this.notificationService}))}createWorkout(e){return this.http.post(`${this.API_URL}/workouts`,e).pipe(n(()=>{this.clearPaginatedWorkoutsCache()}),s({successMessage:"Workout saved successfully!",errorMessage:"Failed to save workout. Please try again.",notificationService:this.notificationService}))}updateWorkout(e,t){return this.http.put(`${this.API_URL}/workouts/${e}`,t).pipe(n(()=>{this.clearPaginatedWorkoutsCache()}),s({successMessage:"Workout updated successfully!",errorMessage:"Failed to update workout. Please try again.",notificationService:this.notificationService}))}getTodaysWorkout(){return this.http.get(`${this.API_URL}/workouts/todays-workout`).pipe(s({errorMessage:"Failed to load today's workout. Please try again.",notificationService:this.notificationService}))}getWorkoutById(e){return this.http.get(`${this.API_URL}/workouts/${e}`).pipe(s({errorMessage:"Failed to load workout. Please try again.",notificationService:this.notificationService}))}readCachedLastMonthWorkouts(e){let t=e?new Date(e):new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1,23,59,59,999),r=new Date(o);if(r.setMonth(r.getMonth()-1),this.paginatedWorkoutsCache.size>0){let p=[];this.paginatedWorkoutsCache.forEach(m=>{p.push(...m.data)});let C=p.filter((m,S,P)=>S===P.findIndex(w=>w.id===m.id)),k=this.sortAndFilterWorkouts(C,r,o);if(k.length>2)return u(k)}let a={page:1,pageSize:31,fromDate:r.toISOString(),toDate:o.toISOString()};return this.getPaginatedWorkouts(a).pipe(v(p=>this.sortAndFilterWorkouts(p.data,r,o)))}sortAndFilterWorkouts(e,t,o){return e.filter(r=>{let a=new Date(r.dateCreated);return a>=t&&a<=o}).sort((r,a)=>new Date(a.dateCreated).getTime()-new Date(r.dateCreated).getTime())}clearPaginatedWorkoutsCache(){this.paginatedWorkoutsCache.clear()}static \u0275fac=function(t){return new(t||i)(c(l),c(f))};static \u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a,W as b,b as c};
